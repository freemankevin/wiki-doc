---
title: 防火墙配置
description: Security - 防火墙配置
published: true
date: 2026-01-30T06:58:14.335Z
tags: linux, redhat, debian, ubuntu, firewalld, iptables, ufw
editor: markdown
dateCreated: 2026-01-30T01:35:44.030Z
---

# 防火墙配置

> Security 相关的 防火墙配置 问题收集
{.is-info}


---

## 概述

Linux 防火墙主要分为两大类：
- **RedHat 系列**（CentOS、RHEL、Fedora）：使用 `firewalld`
- **Debian 系列**（Ubuntu、Debian）：使用 `ufw`
- **通用工具**：`iptables`（较复杂但功能强大）

---

## RedHat 系列（firewalld）

### 查看防火墙状态

```bash
# 查看防火墙运行状态
systemctl status firewalld

# 查看防火墙是否启用
firewall-cmd --state

# 查看当前活跃的区域
firewall-cmd --get-active-zones

# 查看默认区域
firewall-cmd --get-default-zone
```

### 启动/停止/重启防火墙

```bash
# 启动防火墙
systemctl start firewalld

# 停止防火墙
systemctl stop firewalld

# 重启防火墙
systemctl restart firewalld

# 设置开机自启
systemctl enable firewalld

# 禁用开机自启
systemctl disable firewalld

# 重新加载配置（不断开已建立的连接）
firewall-cmd --reload
```

### 查看规则

```bash
# 查看所有开放的端口
firewall-cmd --list-ports

# 查看所有开放的服务
firewall-cmd --list-services

# 查看特定区域的所有规则
firewall-cmd --zone=public --list-all

# 查看所有规则详细信息
firewall-cmd --list-all-zones

# 查看特定区域的端口
firewall-cmd --zone=public --list-ports

# 检查特定端口是否开放
firewall-cmd --query-port=80/tcp
```

### 添加规则（增）

```bash
# 开放端口（临时，重启后失效）
firewall-cmd --add-port=80/tcp

# 开放端口（永久）
firewall-cmd --permanent --add-port=80/tcp

# 开放多个端口范围
firewall-cmd --permanent --add-port=8000-9000/tcp

# 开放 UDP 端口
firewall-cmd --permanent --add-port=53/udp

# 添加服务（如 HTTP、HTTPS、SSH）
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --permanent --add-service=ssh

# 允许特定 IP 访问
firewall-cmd --permanent --add-rich-rule="rule family='ipv4' source address='192.168.1.100' port protocol='tcp' port='3306' accept"

# 允许特定 IP 段访问
firewall-cmd --permanent --add-rich-rule="rule family='ipv4' source address='192.168.1.0/24' port protocol='tcp' port='22' accept"
```

### 删除规则（删）

```bash
# 删除开放的端口
firewall-cmd --permanent --remove-port=80/tcp

# 删除多个端口
firewall-cmd --permanent --remove-port=8000-9000/tcp

# 删除服务
firewall-cmd --permanent --remove-service=http

# 删除 rich rule
firewall-cmd --permanent --remove-rich-rule="rule family='ipv4' source address='192.168.1.100' port protocol='tcp' port='3306' accept"
```

### 修改规则（改）

```bash
# 修改默认区域
firewall-cmd --set-default-zone=public

# 将网卡添加到指定区域
firewall-cmd --permanent --zone=public --add-interface=eth0

# 将网卡从区域移除
firewall-cmd --permanent --zone=public --remove-interface=eth0

# 修改源地址的区域
firewall-cmd --permanent --zone=public --add-source=192.168.1.0/24

# 修改端口的区域
firewall-cmd --permanent --zone=public --add-port=8080/tcp
```

### 重新加载配置

```bash
# 重新加载防火墙配置（必须执行）
firewall-cmd --reload

# 完全重启防火墙（断开已建立的连接）
firewall-cmd --complete-reload
```

---

## Debian 系列（ufw）

### 查看防火墙状态

```bash
# 查看防火墙运行状态
sudo ufw status

# 查看详细状态
sudo ufw status verbose

# 列出所有规则
sudo ufw show added

# 查看编号形式的规则（便于删除）
sudo ufw status numbered
```

### 启动/停止防火墙

```bash
# 启用防火墙
sudo ufw enable

# 禁用防火墙
sudo ufw disable

# 重置防火墙（删除所有规则）
sudo ufw reset
```

### 查看规则

```bash
# 查看所有规则
sudo ufw show raw

# 查看入站规则
sudo ufw show incoming

# 查看出站规则
sudo ufw show outgoing

# 检查特定端口是否开放
sudo ufw show added | grep 80
```

### 添加规则（增）

```bash
# 开放端口
sudo ufw allow 80

# 开放 TCP 端口
sudo ufw allow 80/tcp

# 开放 UDP 端口
sudo ufw allow 53/udp

# 开放端口范围
sudo ufw allow 8000:9000/tcp

# 允许特定 IP 访问
sudo ufw allow from 192.168.1.100

# 允许特定 IP 访问特定端口
sudo ufw allow from 192.168.1.100 to any port 22

# 允许 IP 段访问
sudo ufw allow from 192.168.1.0/24 to any port 22

# 允许服务（如 SSH、HTTP）
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https

# 拒绝访问
sudo ufw deny 23

# 限制访问（防止暴力破解）
sudo ufw limit 22/tcp

# 限制来自特定 IP 的连接
sudo ufw limit from 192.168.1.100 to any port 22
```

### 删除规则（删）

```bash
# 删除规则（方法1：直接指定）
sudo ufw delete allow 80

# 删除规则（方法2：使用编号）
sudo ufw status numbered  # 先查看编号
sudo ufw delete 3         # 删除第 3 条规则

# 删除 IP 规则
sudo ufw delete allow from 192.168.1.100

# 删除特定端口的 IP 规则
sudo ufw delete allow from 192.168.1.100 to any port 22
```

### 修改规则（改）

```bash
# 修改默认入站策略为拒绝
sudo ufw default deny incoming

# 修改默认出站策略为允许
sudo ufw default allow outgoing

# 修改默认路由策略
sudo ufw default deny routed

# 启用/禁用日志记录
sudo ufw logging on
sudo ufw logging off

# 查看日志
sudo tail -f /var/log/ufw.log
```

---

## 通用防火墙（iptables）

### 查看规则

```bash
# 查看所有规则
iptables -L

# 查看详细规则（包括包数和字节数）
iptables -L -v

# 查看输入链规则
iptables -L INPUT

# 查看输出链规则
iptables -L OUTPUT

# 查看转发链规则
iptables -L FORWARD

# 显示规则号
iptables -L --line-numbers

# 查看 NAT 规则
iptables -t nat -L

# 以原始格式显示规则（可用于保存）
iptables -S
```

### 添加规则（增）

```bash
# 允许特定端口（TCP）
iptables -A INPUT -p tcp --dport 80 -j ACCEPT

# 允许特定端口（UDP）
iptables -A INPUT -p udp --dport 53 -j ACCEPT

# 允许来自特定 IP
iptables -A INPUT -s 192.168.1.100 -j ACCEPT

# 允许特定 IP 访问特定端口
iptables -A INPUT -s 192.168.1.100 -p tcp --dport 3306 -j ACCEPT

# 允许 IP 段访问
iptables -A INPUT -s 192.168.1.0/24 -p tcp --dport 22 -j ACCEPT

# 允许本地回环接口
iptables -A INPUT -i lo -j ACCEPT

# 允许已建立的连接
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# 在特定位置插入规则（在第 1 条规则前插入）
iptables -I INPUT 1 -p tcp --dport 443 -j ACCEPT

# 允许 ICMP（ping）
iptables -A INPUT -p icmp -j ACCEPT
```

### 删除规则（删）

```bash
# 删除规则（方法1：指定完整规则）
iptables -D INPUT -p tcp --dport 80 -j ACCEPT

# 删除规则（方法2：使用行号）
iptables -L --line-numbers  # 先查看规则号
iptables -D INPUT 3         # 删除 INPUT 链第 3 条规则

# 清空特定链的所有规则
iptables -F INPUT

# 清空所有规则
iptables -F

# 删除自定义链
iptables -X
```

### 修改规则（改）

```bash
# 修改规则（需要先删除再添加，或使用 -R 选项）
iptables -R INPUT 2 -p tcp --dport 8080 -j ACCEPT

# 设置默认策略（DROP 拒绝，ACCEPT 允许）
iptables -P INPUT DROP
iptables -P OUTPUT ACCEPT
iptables -P FORWARD DROP
```

### 保存和恢复规则

```bash
# 保存规则（RedHat 系列）
service iptables save
# 或
iptables-save > /etc/iptables/rules.v4

# 保存规则（Debian 系列）
iptables-save > /etc/iptables/rules.v4

# 恢复规则
iptables-restore < /etc/iptables/rules.v4

# 开机自启（Debian）
apt-get install iptables-persistent
netfilter-persistent save
```

---

## 常见场景

### 场景 1：开放 Web 服务端口

**RedHat（firewalld）：**
```bash
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```

**Debian（ufw）：**
```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

### 场景 2：开放 SSH 并限制 IP 访问

**RedHat（firewalld）：**
```bash
firewall-cmd --permanent --add-rich-rule="rule family='ipv4' source address='192.168.1.0/24' port protocol='tcp' port='22' accept"
firewall-cmd --permanent --add-rich-rule="rule family='ipv4' port protocol='tcp' port='22' reject"
firewall-cmd --reload
```

**Debian（ufw）：**
```bash
sudo ufw default deny incoming
sudo ufw allow from 192.168.1.0/24 to any port 22
sudo ufw enable
```

### 场景 3：开放数据库端口（仅内网访问）

**RedHat（firewalld）：**
```bash
firewall-cmd --permanent --add-rich-rule="rule family='ipv4' source address='192.168.1.0/24' port protocol='tcp' port='3306' accept"
firewall-cmd --reload
```

**Debian（ufw）：**
```bash
sudo ufw allow from 192.168.1.0/24 to any port 3306
```

### 场景 4：端口转发

**使用 iptables：**
```bash
# 将 80 端口转发到 8080
iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080

# 启用 IP 转发
echo 1 > /proc/sys/net/ipv4/ip_forward
```

### 场景 5：防止 DDoS 攻击

**RedHat（firewalld）：**
```bash
# 限制同时连接数
firewall-cmd --permanent --add-rich-rule="rule family='ipv4' port protocol='tcp' port='80' limit value='10/m' accept"
firewall-cmd --reload
```

**使用 iptables：**
```bash
# 限制单个 IP 的并发连接数
iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT
iptables -A INPUT -p tcp --dport 80 -j DROP
```


---

[返回 Security](/security)
